---
title: "Lab1 - baseball stats"
---

[Moneyball](http://en.wikipedia.org/wiki/Moneyball_(film)) focuses on the "quest for the secret of success in baseball". It follows a low-budget team, the Oakland A's, who believed that underused statistics, such as a player's ability to get on base, better predict the ability to score runs, rather than typical statistics like HR's, RBI's, and BA. Obtaining players who excelled in these underused statistics turned out to be much more affordable for the team.

We'll be looking at data from all 30 MLB teams and examining the relationships between in-game statistics. 

```{r load-abrbuthnot-data, eval=TRUE}
# access the OpenIntro website and fetch the `mlb11` data set.
download.file("http://www.openintro.org/stat/data/mlb11.RData", destfile = "mlb11.RData")
load("mlb11.RData")
```

Let's load up the data for the 2011 season. In addition to runs scored, there are 7 traditionally-used variables in the data set: AB, hits, HR, BA, SO, SB, and W. There are also 3 newer variables: OBP, slugging %, and on-base plus slugging. For the 1st portion of the analysis, we'll consider the 7 traditional variables. At the end of the lab, we'll work w/ the newer variables.

`mlb11` is a **data frame** w/ 30 observations of 12 variables. 

## The Data: 2011 baseball statistics

Each row represents a different team w/ an index (not actually part of the dataset), team name, + remaining columns = team-specific metrics. 

```{r, eval=TRUE}
# get observations/rows and variables/cols
dim(mlb11)

# get col names
names(mlb11)
```

## Some Exploration

```{r, eval=FALSE}
# returns the column as a vector
mlb11$runs
```

```{r}
head(mlb11)
tail(mlb11)
```

### mosaic

There is an additional package for R called `mosaic` that streamlines all of commands needed in this course. This package is specifically designed by a team of NSF-funded educators to make R more accessible to statistics students. The `mosaic` package doesn't provide new functionality, so much as it makes existing functionality more logical, consistent, all the while emphasizing importants concepts in statistics. 

```{r, eval=FALSE,message=F}
#install.packages("mosaic")
library(mosaic)
```

The centerpiece of the `mosaic` syntax = the use of the *modeling language*, which involves the use of a tilde (~), which can be read as *"is a function of"*. For example, to create a simple plot of runs each team scored vs. hits:

```{r, eval=FALSE, message=FALSE}
xyplot(runs ~ hits, mlb11)
```

By default, R creates a scatterplot with each (x,y) pair indicated by an open circle. 

**2.  Is there an association between runs scored and hits? How would you describe it?**

Now, suppose we want to plot only the total number of runs.

```{r, eval=FALSE}
histogram( ~ runs, mlb11)
bwplot( ~ runs, mlb11)
```

**3.  Describe the distribution of runs scored among MLB teams in 2011.  What is the median?**

We have a right-skewed distribution, with a median value of just above 700. We know from the skew that the mean *should* be higher than the median, as it would be pulled towards the majority of the data points to the right of the distribution's center.

```{r}
median(mlb11$runs)
mean(mlb11$runs)
```

### Additional R functionalities

Get the total number of homeruns and strikeouts by the Texas Rangers, the first row in our data. We could do this for every row, but there is a faster way. If we add the vectors together, R will compute all sums simultaneously.

```{r, eval=FALSE,message=F}
# all teams
mlb11$homeruns + mlb11$strikeouts
# just rangers
mlb11[1,"homeruns"] + mlb11[1,"strikeouts"]
# tidy
library(tidyverse)
mlb11 %>%
  filter(team == "Texas Rangers") %>%
  mutate(sumHR_SO = homeruns+strikeouts) %>%
  select(sumHR_SO)
```

**4.  Which team had the highest cumulative number of strikeouts and homeruns in 2011?**

```{r}
mlb11[which.max(mlb11$homeruns + mlb11$strikeouts),"team"]
```

**Which home run observations were greater than 200?**

```{r, eval=FALSE}
mlb11$homeruns > 200
```

5.  Which MLB teams had more than 200 home runs in 2011?

```{r}
subset(mlb11, homeruns > 200)
```

## Summaries and tables

A good first step in any analysis is to distill all that info into a few summary statistics and graphics. 
```{r, eval=FALSE}
summary(mlb11$runs)
```

To compute IQR for team runs, one could look at the output above and enter
```{r, eval=FALSE}
734 - 629
```

R also has built-in functions to compute summary statistics one by one. For instance, to calculate the mean, median, and variance of `runs`, type 

```{r, eval=FALSE, message=FALSE}
var(~runs, data=mlb11)
median(~runs, data=mlb11)
```

The `mosaic` command `favstats()`, allows us to compute all of this information (and more) at once, in a data frame. 
```{r, eval=FALSE}
favstats(~runs, data=mlb11)
```

While it makes sense to describe a quantitative variable like `runs` in terms of these statistics, what about categorical data?  We would instead consider the **sample frequency** or **relative frequency distribution**.  The function `tally()` does this by counting the # of times each kind of response was given.
```{r, eval=FALSE}
# see # of teams who hit at least 200 homeruns
mlb11$HighHR <- mlb11$homeruns >= 200
mlb11$HighHR
tally(~ HighHR, data=mlb11)
```

or instead look at the **relative frequency distribution** by typing
```{r, eval=FALSE}
tally(~ HighHR, data=mlb11, format="proportion")
```

In each of the above steps, we make use of a new variable, `HighHR` and then used it in as the input for `tally()`.

Next, we make a bar chart of entries in the table by putting the table inside `barchart()`.
```{r, eval=FALSE}
barchart(tally(~HighHR, data=mlb11, margins=FALSE), horizontal=FALSE)
```

We've computed the table of + then immediately applied the graphical function, `barchart`.

6.  Create a numerical summary for `stolen_bases` and `wins`, and compute the interquartile range for each. 
```{r}
favstats(mlb11$stolen_bases)
favstats(mlb11$stolen_bases)$max - favstats(mlb11$stolen_bases)$min 

favstats(mlb11$wins)
favstats(mlb11$wins)$max - favstats(mlb11$wins)$min
```

7.  Compute the relative frequency distribution for teams with at least 90 `wins`. How many teams reached 90 wins?  
```{r}
mlb11$HighW <- mlb11$wins >= 90
length(mlb11$HighW)
tally(~ HighW, data=mlb11)
```

`tally` can be used to tabulate any number of variables that you provide.  

8.  What is shown in the following table?  How many teams won 90 or more games and hit at least 200 home runs? 
```{r table-smoke-gender, eval=FALSE}
mlb11$HighWins <- mlb11$wins >=90
tally(HighWins ~ HighHR, data=mlb11, format="count")
```
The above shows the number of teams that had at least 90 wins *and* at least 200 home runs in a matrix. Only 3 teams had done so.


9.  Describe the center, shape, and spread of the `stolen_bases` variable, using an appropriate plot and the appropriate metrics.
```{r}  
fav_stats(mlb11$stolen_bases)
hist(mlb11$stolen_bases)
```

This is right skewed, with a median and mean around 108 SB's, with a spread of about +/- 30 SB's.

**10.  A coach is interested in the link between `stolen_bases` and `runs`. Show the coach a scatter plot, and describe the association. As you make the plot, think carefully about which of these two variables is the explanatory variable (and which is the response).**
```{r}
### Enter code here.
plot(mlb11$stolen_bases,mlb11$runs)
cor(mlb11$stolen_bases,mlb11$runs)
```

There seems to be no association between stolen bases and runs, as we can see from the scatterplot and the low Pearsons' correlation coefficient.

**11.   How can you change the x and y labels on your plots? How can you add a title?
```{r}
### Enter code here.
library(ggplot2)
ggplot(mlb11, aes(stolen_bases,runs)) +
  geom_point() + 
  xlab("Stolen Bases") + 
  ylab("Runs") + 
  ggtitle("Runs vs. Stolen Bases")
cor(mlb11$stolen_bases,mlb11$runs)
```

12.   Using visual evidence, find the variable that you think seems to boast the strongest association to `runs`. Consider any continuous variables between columns 3 (`at_bats`) and 12 (`new_obs`).

```{r}
#names(mlb11)
corr_mat <- cor(mlb11$runs,mlb11[,-1])
corrplot::corrplot(corr_mat)

pairs(~runs+bat_avg+new_onbase+new_slug+new_obs
      ,data=mlb11
      ,main="Simple Scatterplot Matrix")
#cor(mlb11[-1])
```

`new_obs` seems to boast the strongest association to `runs`. 

13.   What is the variance in the number of strikeouts for each team during the 2011 season? 
```{r}
var(mlb11$strikeouts)
```


14.   Make a new variable, `high_BA`, to represent teams that hit for a batting average of 0.270 or more. How many teams fit into this group?

```{r}
mlb11$high_BA <- mlb11$bat_avg >= .270
sum(mlb11$high_BA)
```

15.   You can use `favstats` to get the summary statistics within each `high_BA` group, and `bwplot()` to make boxplots. For example, what appears to be the link between `homeruns` and `high_BA`? Do teams with higher batting averages tend to hit more home runs?

```{r, eval = FALSE}
favstats(homeruns ~ high_BA, data = mlb11)
densityplot(~ homeruns, groups = high_BA, data = mlb11, auto.key = TRUE)
#bwplot(mlb11$homeruns, groups = mlb11$high_BA, data = mlb11)
```

16.   Repeat the code above, only using `stolen_bases` instead of `homeruns`. Does there appear to be a link between `stolen bases` and `high_BA`? 

```{r, eval = FALSE}
favstats(stolen_bases ~ high_BA, data = mlb11)
densityplot(~ stolen_bases, groups = high_BA, data = mlb11, auto.key = TRUE)
```

<div id="license">
Portions of this lab were adapted for OpenIntro by Andrew Bray and Mine &Ccedil;etinkaya-Rundel from a lab written by Mark Hansen of UCLA Statistics, a product of OpenIntro that is released under a 
[Creative Commons License](http://creativecommons.org/licenses/by-sa/3.0)
</div>